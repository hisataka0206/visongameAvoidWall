# ゴール Webカメラを使って、テレビ番組の「脳カベ（Hole in the Wall）」のようなゲームを作成してください。 迫ってくる壁に空いた「穴」の形に合わせてポーズをとり、壁にぶつからずにすり抜けるゲームです。 HTML5 Canvas、JavaScript、MediaPipe Pose（CDN経由）を使用し、単一のHTMLファイル（index.html）で動作するようにしてください。

# 基本仕様

カメラ入力:

PCの内蔵カメラ映像を取得し、画面全体に表示する。

鏡のように動けるよう、映像は必ず左右反転（ミラーリング）させる。

ポーズ検出:

MediaPipe Poseを使用して、全身のランドマークをリアルタイムで検出する。

デバッグ用に、検出した骨格（スケルトン）をカメラ映像の上に細い線でオーバーレイ表示する。

ゲーム画面構成:

カメラ映像レイヤーのさらに上に、ゲームUI（スコア、迫ってくる壁）を描画するCanvasレイヤーを重ねる。

# ゲームメカニクス（詳細） 1. ゲームの流れ:

スタートボタンでゲーム開始。

ランダムに「指定ポーズ」が決定される。

画面奥から手前に向かって、そのポーズの形の穴が開いた「壁」が迫ってくるアニメーションを開始する。

壁が完全に手前に到達した瞬間（通過タイミング）に、プレイヤーのポーズが穴の形と合っているかを判定する。

成功（Clear）: スコア加算、次の壁へ。

失敗（Crash）: ライフが減る、またはゲームオーバー。「ドカーン！」というような衝突エフェクトを表示。

壁が迫ってくるスピードは、ステージが進むにつれて徐々に速くなる。

2. 壁とポーズの種類（まずは3種類で実装）: 壁は3Dオブジェクトではなく、「2Dの壁のイラストが中央から拡大してくる」表現で良い。 穴以外の部分は半透明の赤色などで塗りつぶし、「ここにはみ出したらアウト」というエリアを視覚的に示す。

ポーズA: 「バンザイ（Yポーズ）」

壁の形: 人が両手を斜め上に上げたY字型の穴。

成功判定条件:

「左手首(Left Wrist)」のY座標が「鼻(Nose)」のY座標より上にある。

かつ、「右手首(Right Wrist)」のY座標が「鼻(Nose)」のY座標より上にある。

かつ、両手首のX座標が、両肩のX座標よりも外側にあること。

ポーズB: 「気をつけ（Iポーズ）」

壁の形: 人が直立して腕を体に付けたI字型の穴（細長い穴）。

成功判定条件:

「左手首」と「左腰(Left Hip)」の距離が近い（閾値以内）。

かつ、「右手首」と「右腰(Right Hip)」の距離が近い（閾値以内）。

（腕が広がっていないことを検知する）

ポーズC: 「しゃがむ（Squat）」

壁の形: 画面の下半分しか穴が開いていない壁（上半分が全部壁）。

成功判定条件:

「鼻(Nose)」のY座標が、画面の中央の高さよりも下にあること。

3. 判定のタイミング（重要）:

常に判定を行うのではなく、壁のアニメーションが完了し、壁が「最も手前に来た瞬間」の1フレームでのみ判定を行うこと。

判定の瞬間に画面を少しフラッシュさせるなどして、タイミングをわかりやすくする。

# UIデザイン

スコア表示: 画面左上に大きく現在のスコアを表示。

残りライフ: ハートマークなどで残りライフ（例: 3つ）を表示。

雰囲気: バラエティ番組のような、少しコミカルで緊迫感のあるデザイン。

# エラーハンドリング

カメラへのアクセスが許可されなかった場合のアラート表示。

MediaPipeのモデルロード中はローディング画面を表示し、完了してからスタートボタンを有効にする。

## 1. 設定の集約 (Config Object)
コードの冒頭（`const` 定義エリア）に、ゲームバランスを簡単に調整できる `GAME_CONFIG` オブジェクトを作成し、マジックナンバーを排除してください。
最低限、以下のパラメータを含めてください。

```javascript
const GAME_CONFIG = {
    initialSpeed: 5.0,       // 壁の初期速度
    maxSpeed: 20.0,          // 壁の最大速度
    speedIncrement: 0.5,     // 1回クリアするごとの加速量
    spawnInterval: 3000,     // 次の壁が出るまでの待機時間（ミリ秒）
    judgementFrameCount: 5,  // 判定を行うフレーム数（一瞬すぎて判定漏れしないように）
};

## 2. ゲームループの改良（インターバルの実装）
壁の処理をステートマシン化し、**「壁が通り過ぎた後、次の壁が出るまで数秒待つ（休憩時間）」**というフェーズを入れてください。

Waitフェーズ: 画面中央に「Next Wall in 3... 2... 1...」のようなカウントダウン、または「Ready?」というテキストを表示する。

Actionフェーズ: 壁が生成され、迫ってくる。

Resultフェーズ: 判定後、〇か×かを表示する。

(戻る): 再びWaitフェーズへ。

## 3. 難易度曲線 (Difficulty Curve)
ゲーム開始時は initialSpeed でゆっくり始める。

壁をクリアするたびに、速度を speedIncrement ずつ上げ、maxSpeed まで速くしていく。

これにより、序盤は練習、後半はハイスピードな反射神経ゲームになるようにする。

## 4. UI改善
現在のレベル（Speed）や、次の壁が出るまでのカウントダウンが視覚的にわかるようにCanvas上に描画してください。



## 1. エフェクト管理変数の追加
ステート管理に、エフェクトの状態を保持する変数を追加してください。

```javascript
let effectState = {
    type: null,        // 'clear' または 'miss' または null
    timer: 0,          // エフェクト表示の残り時間フレーム
    shakeIntensity: 0  // 画面揺れの強度
};
const EFFECT_DURATION = 30; // エフェクトを表示するフレーム数（約0.5秒）
```

## 2. 判定時の処理追加
判定ロジック（壁が通過する瞬間）で、結果に応じてエフェクトを発火させてください。

成功時:

effectState.type = 'clear';

effectState.timer = EFFECT_DURATION;

失敗時:

effectState.type = 'miss';

effectState.timer = EFFECT_DURATION;

effectState.shakeIntensity = 20; // 揺れの強さ


##  3. 描画ループ内でのエフェクト描画処理
draw() 関数の最後で、effectState.timer > 0 の場合にエフェクトを描画します。

### A. 画面シェイク（失敗時のみ）
失敗時、shakeIntensity を使ってCanvas全体をランダムにずらして描画し、衝撃を表現してください。 （ctx.save(), ctx.translate(), ctx.restore() を使用）

### B. 画面フラッシュ（オーバーレイ）
Canvas画面全体を覆う半透明の矩形を描画します。

成功時: 鮮やかな緑色（例: rgba(0, 255, 100, 0.5)）でフラッシュ。時間が経つにつれて透明にしていく。

失敗時: 鮮やかな赤色（例: rgba(255, 50, 50, 0.6)）でフラッシュ。

### C. テキスト表示
画面中央に大きな文字を描画します。

成功時: 白フチの緑文字などで「COOL!」や「PERFECT!」

失敗時: 赤黒い文字などで「MISS...」や「CRASH!」

フォントサイズは大きく、インパクトのあるものにしてください。

### D. タイマー更新
毎フレーム effectState.timer をデクリメントし、0になったら type を null に戻してください。失敗時の shakeIntensity も徐々に減衰させてください。

# 追加仕様：ポーズのバリエーション追加
ゲームをより面白くするため、認識するポーズの種類を以下の5つ追加してください。
壁の穴の形（描画）と、判定ロジック（JavaScript）の両方を実装してください。

### 追加ポーズ定義

1. **「X（エックス）」**
   - **壁の形:** 画面の四隅に向かって伸びるX字型の穴。
   - **判定条件:**
     - 両手首(Wrists)が頭(Nose)より上にある。
     - かつ、両手首のX座標の距離が十分に広い。
     - かつ、両足首(Ankles)のX座標の距離が、両肩(Shoulders)の幅よりも明らかに広い。

2. **「T（ティー）」**
   - **壁の形:** 十字架のようなT字型の穴。
   - **判定条件:**
     - 両手首(Wrists)のY座標が、両肩(Shoulders)のY座標とほぼ同じ高さ（許容誤差を持たせる）にあること。
     - 両手首のX座標が、体の中心から十分に離れていること。

3. **「マッスル（Muscle）」**
   - **壁の形:** 力こぶを作るような、腕を直角に曲げた穴。
   - **判定条件:**
     - 両肘(Elbows)が肩(Shoulders)とほぼ同じ高さにある。
     - 両手首(Wrists)が肘よりも高い位置にある（バンザイではなく、腕を曲げている状態）。

4. **「フラミンゴ（片足立ち）」**
   - **壁の形:** 下半分が一本足になっている穴。
   - **判定条件:**
     - 左右どちらかの足首(Ankle)のY座標が、もう片方の足首よりも有意に高い位置（膝付近など）にあること。
     - (左右どちらの足を上げてもOKとする)

5. **「トライアングル（腰に手）」**
   - **壁の形:** 腕を曲げて腰に手を当てた、ひし形のようなシルエットの穴。
   - **判定条件:**
     - 両手首(Wrists)の座標が、それぞれの腰(Hips)の座標に近いこと。
     - 肘(Elbows)が外側に張り出していること。