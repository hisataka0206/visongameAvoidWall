
# 脳カベ風ポーズゲーム 仕様書（整理版）

## 0. ゴール / 全体像

Webカメラを使い、テレビ番組の「脳カベ（Hole in the Wall）」のようなゲームを作成する。

* 迫ってくる壁に空いた「穴」の形に合わせてポーズをとる
* 壁にぶつからずにすり抜けられたら成功
* HTML5 Canvas + JavaScript + MediaPipe Pose（CDN）
* **単一HTMLファイル（index.html）で完結**

---

## 1. 技術スタック・前提条件

### 1.1 使用技術

* HTML5
* JavaScript
* HTML5 Canvas
* MediaPipe Pose（CDN経由）

### 1.2 実行条件

* PCの内蔵カメラを使用
* ブラウザ上で動作（追加ビルド不要）

---

## 2. カメラ・ポーズ検出仕様

### 2.1 カメラ入力

* PC内蔵カメラ映像を取得
* 画面全体に表示
* **必ず左右反転（ミラーリング）**
  → 鏡のように直感的に動けるようにする

### 2.2 ポーズ検出

* MediaPipe Pose を使用
* 全身ランドマークをリアルタイム検出

### 2.3 デバッグ表示

* 検出した骨格（スケルトン）を

  * カメラ映像の上に
  * 細い線でオーバーレイ表示

---

## 3. 画面レイヤー構成

1. **最下層**：カメラ映像
2. **中間層**：スケルトン（デバッグ）
3. **最上層**：Canvas（ゲームUI）

Canvas上に描画する要素：

* 壁
* 穴
* スコア
* ライフ
* カウントダウン
* エフェクト

---

## 4. ゲーム進行・ステート設計

### 4.1 ゲームの基本フロー

1. スタートボタンで開始
2. 指定ポーズをランダム選択
3. 壁が奥から手前へ迫ってくる
4. 通過タイミングで判定
5. 成功 or 失敗
6. 次の壁へ（またはゲームオーバー）

---

### 4.2 ゲームステート（ステートマシン）

#### ① Wait フェーズ

* 次の壁が出るまでの待機時間
* 表示例：

  * 「Next Wall in 3...2...1...」
  * または「Ready?」

#### ② Action フェーズ

* 壁生成
* 壁が迫ってくるアニメーション

#### ③ Result フェーズ

* 判定結果を表示（〇 / ×）
* エフェクト再生

→ 再び Wait フェーズへ戻る

---

## 5. 壁・アニメーション仕様

### 5.1 壁表現

* 3Dではなく **2D表現**
* 中央から拡大してくるような表現
* 穴以外の部分は

  * デフォルト半透明の赤色などで塗りつぶし
  * 「ここにはみ出したらアウト」を明示
* /wallディレクトリに置かれている各ポーズの穴についてのpng画像を読み込み、迫ってくる壁として使うこと
* /wallディレクトリに置かれているwall.pngの半透明を使って全体を塗り潰すこと

### 5.2 壁スピード

* ステージが進むごとに加速
* 最大速度あり

---

## 6. 判定仕様（共通ルール）

### 6.1 判定タイミング（重要）

* 常時判定しない
* **壁が最も手前に来た瞬間のみ**
* 数フレームだけ判定を有効にする

```js
judgementFrameCount
```

* 判定の瞬間に画面フラッシュなどの演出を入れる

---

### 6.2 判定構成

1. **位置合わせ判定（X軸）**
2. **ポーズ判定（形状）**

※ 位置がズレていた場合
→ ポーズが合っていても即 MISS

---

## 7. 初期ポーズ（基本3種）

### 7.1 ポーズA：バンザイ（Yポーズ）

* **壁形状**：Y字型の穴
* **判定条件**

  * 左右手首のY座標が鼻より上
  * 両手首のX座標が肩より外側


---

### 7.2 ポーズB：気をつけ（Iポーズ）

* **壁形状**：I字型の細長い穴
* **判定条件**

  * 左手首と左腰が近い
  * 右手首と右腰が近い

---

### 7.3 ポーズC：しゃがむ（Squat）

* **壁形状**：下半分のみ穴
* **判定条件**

  * 鼻のY座標が画面中央より下

---

## 8. 追加ポーズ（上半身・バランス系）

### 8.1 X（エックス）

* **壁形状**：X字型
* **判定条件**

  * 両手首が鼻より上
  * 両手首X距離が広い
  * 両足首X距離 > 肩幅

---

### 8.2 T（ティー）

* **壁形状**：T字型
* **判定条件**

  * 手首Y ≒ 肩Y（許容誤差あり）
  * 手首Xが体中心から十分離れている

---

### 8.3 フラミンゴ（片足立ち）

* **壁形状**：下半分が一本足
* **判定条件**

  * 片方の足首Yがもう片方より有意に高い
  * 左右どちらでもOK

---

## 9. 足強化・全身運動仕様

### 9.1 壁出現位置ランダム化（サイドステップ）

#### レーン仕様

* 左・中央・右 の3レーン
* 例：画面幅 30% / 50% / 70%

#### 判定ルール

* 壁の offsetX を基準に
* プレイヤーの **腰（Hips）中心X** が合っているか判定
* 合っていなければ即 MISS

#### 視覚ガイド

* 画面下部に

  * 「STAND HERE」
  * 矢印・枠線マーカー

---

### 9.2 下半身強化ポーズ

#### A. SUMO（四股）

* **壁形状**：横に広く低い穴
* **判定条件**

  * 足首X距離 ≥ 肩幅×2
  * 腰Yが明らかに低い
  * 手は膝 or 腰付近

---

#### B. KICK（サイドキック）

* **壁形状**：片足だけ横に出た穴
* **判定条件**

  * 片足首Yが腰付近まで上がる
  * 軸足は地面
  * 判定は甘め

---

## 10. UIデザイン

### 10.1 表示要素

* スコア：左上・大きく表示
* ライフ：ハート表示（例：3）
* 現在速度（レベル）
* 次の壁までのカウントダウン

### 10.2 雰囲気

* バラエティ番組風
* コミカル＋緊迫感

---

## 11. エフェクト仕様

### 11.1 エフェクト状態管理

```js
let effectState = {
  type: null,
  timer: 0,
  shakeIntensity: 0
};
const EFFECT_DURATION = 30;
```

---

### 11.2 判定時の発火

#### 成功時

* type = 'clear'
* timer = EFFECT_DURATION

#### 失敗時

* type = 'miss'
* timer = EFFECT_DURATION
* shakeIntensity = 20

---

### 11.3 描画処理

#### A. 画面シェイク（失敗時）

* ctx.translate() を使用
* shakeIntensity は徐々に減衰

#### B. フラッシュ

* 成功：緑（rgba(0,255,100,0.5)）
* 失敗：赤（rgba(255,50,50,0.6)）

#### C. テキスト

* 成功：「COOL!」「PERFECT!」
* 失敗：「MISS...」「CRASH!」
* 大きくインパクト重視

#### D. タイマー更新

* 毎フレーム timer--
* 0でリセット

---

## 12. ゲームバランス設定（Config）

```js
const GAME_CONFIG = {
  initialSpeed: 5.0,
  maxSpeed: 20.0,
  speedIncrement: 0.5,
  spawnInterval: 3000,
  judgementFrameCount: 5,
};
```

---

## 13. 難易度曲線

* 初期：ゆっくり（練習）
* クリアごとに speedIncrement 加速
* maxSpeed で頭打ち
* 後半は反射神経ゲーム

---

## 14. エラーハンドリング

* カメラ未許可時：アラート表示
* MediaPipeロード中：

  * ローディング画面表示
  * 完了後にスタートボタン有効化
* フレームアウト時：

  * 「もっと下がって！」等の警告UI

---

